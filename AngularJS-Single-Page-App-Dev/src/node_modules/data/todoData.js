/**
 * Created with JetBrains WebStorm.
 * User: Ben
 * Date: 5/19/13
 * Time: 1:17 PM
 * To change this template use File | Settings | File Templates.
 */
var __ = require('underscore');

var todos = [{
    id: 1,
    title: 'First Todo',
    description: 'You should really add your first todo.',
    due: new Date(),
    done: null
}];

function getNextId() {
    return __.max(todos, function (x) { return x.id }) + 1;
}
exports.getAll = function() {
    return todos;
};

exports.getById = function(id) {
    return __.find(todos, function(x) { return x.id == id; });
};

exports.save = function(todo) {
    if(todo.id && todo.id > 0) {
        return exports.update(todo);
    }
    return exports.insert(todo);
}

exports.insert = function (todo) {
    todo.id = getNextId();
    todos.push(todo);
    return todo;
};

exports.update = function(todo) {
    var target = __.find(todos, function(x) { return x.id == todo.id; })
    __.extend(target, todo);
    return target;
};

exports.delete  = function(id) {
    var origLength = todos.length;
    todos = __.reject(todos, function(x) { return x.id == id; });
    return origLength - todos.length;
};